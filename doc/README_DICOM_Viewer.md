# DICOM Viewer - 医学序列浏览与转换工具

这是一个基于 Python 和 Tkinter 开发的高效 DICOM 序列查看器，支持快速浏览大量病例，筛选 MRI 序列，并一键将其导出为 NIfTI 格式。

![alt text](../img/DICOM_Viewer.png)

## 🌟 核心功能

*   **高效浏览布局**：
    *   **两栏式设计**: 左侧整合展示“病例列表”和“序列列表”，右侧大窗口专注于图像显示。
    *   **实时统计**: 动态显示当前加载的病例总数，以及筛选后的序列数量。
*   **智能筛选 (Regex)**：
    *   内置正则表达式过滤器，可快速查找特定序列（如输入 `T2`、`ax`、`sag` 等），支持忽略大小写。
*   **图像交互**：
    *   **窗宽窗位 (Windowing)**: 支持鼠标拖拽快速调整图像对比度和亮度。
    *   **切片导航**: 支持鼠标滚轮流畅切换切片。
    *   **元数据**: 随时查看 DICOM Tags 信息。
*   **NIfTI 导出工作流**：
    *   **静默导出**: 导出过程不弹窗干扰，通过底部状态栏颜色反馈结果（成功为绿色，失败为红色）。
    *   **路径预设**: 支持设置默认导出文件夹，省去重复选择路径的麻烦。
    *   **自动命名**: 导出文件自动规范命名为 `pcfd_{病例文件夹名}_0000.nii.gz`。

## 🛠 安装依赖

在使用本软件前，请确保您的环境中安装了以下 Python 库：

```bash
pip install numpy pydicom SimpleITK pillow
```

*   **Python 版本**: 建议 Python 3.8+
*   **依赖说明**: 
    *   `SimpleITK`: 核心图像读取与处理库。
    *   `pydicom`: 用于解析 DICOM 元数据。

## 🚀 使用指南

### 1. 启动软件
在终端中运行以下命令启动程序：

```bash
python dicom_viewer.py
```

### 2. 加载数据
*   点击左上角的 **“选择根文件夹 (Root)”** 按钮。
*   **默认路径**: 软件默认尝试打开 `~/Desktop/WAIYUAN_DATA_DCM`。
*   **目录结构**: 请选择包含多个以病人/病例命名的子文件夹的父目录。

### 3. 操作说明

| 功能 | 操作方式 | 说明 |
| :--- | :--- | :--- |
| **切换切片** | 鼠标滚轮 | 上下翻阅当前序列的切片 |
| **调整窗宽窗位** | 鼠标 **左键按住拖动** | <br>↔️ 左右拖动：调整窗宽 (对比度)<br>↕️ 上下拖动：调整窗位 (亮度) |
| **过滤序列** | 左侧输入框 "过滤(Regex)" | 输入关键词如 `t2` 筛选列表 |
| **选择病例/序列** | 鼠标左键点击列表项 | 切换浏览不同的数据 |

### 4. NIfTI 导出功能

本软件专门优化了数据清洗转换的流程：

1.  **设置导出路径** (可选):
    *   点击 **"设置导出文件夹 (Output)"**。
    *   默认指向 `~/Desktop`。设置后，所有导出操作将文件直接保存到该目录。
2.  **执行导出**:
    *   在序列列表中选中需要导出的序列。
    *   点击 **"导出选中序列 NIfTI"** 按钮。
3.  **状态反馈**:
    *   软件底部状态栏会显示导出进度。
    *   Completed (Green): **绿色文字**提示导出成功，并显示文件具体路径。
    *   Failed (Red): **红色文字**提示错误原因（如未设置路径、未选中序列等）。
    *   *注：如果目标路径已存在同名文件，将自动覆盖而不弹窗提示。*

## 📁 输出文件命名

导出的 NIfTI 文件将采用以下命名格式，便于后续流水线处理：

```
pcfd_{CaseName}_0000.nii.gz
```

*   `{CaseName}`: 对应 DICOM 所在的父文件夹名称。

